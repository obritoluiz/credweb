unit Usenha;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics,
  Controls, Forms, uniGUITypes, uniGUIAbstractClasses,
  uniGUIClasses, uniGUImClasses, uniGUIForm, uniGUImForm, uniGUImJSForm;

type
  TFunctionSenha = class(TUnimForm)
  function alterarSenha(senhaAtual : string; senhaSalva : string; senhaNova : string; senhaNovaConf : string): Integer;
  private
    { Private declarations }
  public
    { Public declarations }
  end;

function FunctionSenha: TFunctionSenha;

implementation

{$R *.dfm}

uses
  MainModule, Mainm, uniGUIApplication;

function FunctionSenha: TFunctionSenha;
begin
  Result := TFunctionSenha(UniMainModule.GetFormInstance(TFunctionSenha));
end;

function TFunctionSenha.alterarSenha(senhaAtual : string; senhaSalva : string; senhaNova : string; senhaNovaConf : string): Integer;
var
  senhaNovaMD5 :string;
begin
  if senhaAtual = senhaSalva then
  begin
    if senhaNova = senhaNovaConf then
    begin
      senhaNovaMD5 :=  frmPrincipal.MD5(senhaNova);

      if (senhaNova = '') or
         (senhaNova = NULL) or
         (senhaNova.Length < 6) or
         (senhaNova = '123456') then
      begin
//        ShowMessage('Senha inválida, por favor digite uma senha que tenha pelo menos 6 caracteres.');
        result := 2;
      end
      else if senhaAtual = senhaNovaMD5 then
      begin
//        ShowMessage('Erro, a senha nova precisa ser diferente da senha antiga.');
        result := 3;
      end
      else
      begin
//        with UniMainModule.dsUsuario.DataSet do
//        begin
//          edit;
//          FieldByName('SENHA').Value := senhaNovaMD5;
//          post;
//        end;
//        ShowMessage('Senha alterada com sucesso.');
        result := 1;
      end;
    end
    else
    begin
//      ShowMessage('As senhas não coincidem, por favor certifique-se que as duas senhas sejam iguais.');
      result := 4;
    end;
  end
  else
  begin
//    ShowMessage('Senha atual não foi inserida corretamente');
    result := 5;
  end;
end;

end.
